# Frontend Architecture & Implementation Suggestions for Admissions CRM

## 1. Technology Stack Recommendations

To build a robust, scalable, and "vibe coding" friendly frontend that matches your backend's capabilities, I recommend the following stack:

*   **Framework**: **Next.js 14+ (App Router)** - For server-side rendering, SEO (important for public lead forms), and robust routing.
*   **Language**: **TypeScript** - Essential for type safety, especially with the complex data models (Leads, Campaigns, Budgets) defined in your backend.
*   **Styling**: **Tailwind CSS** + **Shadcn UI** - For rapid, beautiful, and accessible UI development. Shadcn provides copy-paste components that are highly customizable.
*   **State Management**: **Zustand** - Lightweight and easier to manage than Redux for global state (User Auth, Sidebar state).
*   **Data Fetching**: **TanStack Query (React Query)** - Critical for managing server state, caching, and background updates (e.g., live call monitoring).
*   **Forms**: **React Hook Form** + **Zod** - For efficient form handling and validation that mirrors your backend Joi schemas.
*   **Icons**: **Lucide React** - Clean, modern icons.

---

## 2. Project Structure (Next.js App Router)

```
/app
  /(auth)
    /login/page.tsx          # Login Screen
    /register/page.tsx       # (Optional) Register Screen
  /(dashboard)               # Protected Layout with Sidebar/Header
    /layout.tsx              # Auth Check & Sidebar Provider
    /page.tsx                # Main Dashboard (Widgets based on Role)
    /leads/
      /page.tsx              # Leads Kanban/List View
      /[id]/page.tsx         # Lead Details & History
    /campaigns/
      /page.tsx              # Campaign List & Status Toggle
      /create/page.tsx       # Multi-step Campaign Wizard
      /[id]/page.tsx         # Campaign Details & Asset Manager
    /budgets/
      /page.tsx              # Budget Requests & Approvals
    /accounting/
      /page.tsx              # Payment Records & Ad Spends
    /telephony/
      /page.tsx              # Smartflo Dialer & Live Calls
    /users/
      /page.tsx              # Admin User Management
  /submit-lead/page.tsx      # Public Lead Submission Form (No Auth)
/components
  /ui                        # Shadcn UI Components
  /forms                     # Reusable Form Components
  /tables                    # Data Tables (TanStack Table)
  /telephony                 # Dialer & Call Controls
/lib
  /api.ts                    # Axios Instance with Interceptors (Auth/Refresh)
  /utils.ts                  # Helper functions (Date formatting)
/hooks                       # Custom Hooks (useAuth, useLeads, useSmartflo)
```

---

## 3. Authentication Flow

1.  **Login**:
    *   **UI**: Email & Password fields.
    *   **Action**: POST `/api/v1/auth/login`
    *   **Handling**: Store `accessToken` in memory/Zustand. The `refreshToken` is automatically handled via HTTP-Only cookie.
    *   **Redirect**: To `/dashboard` upon success.

2.  **Token Refresh (Axios Interceptor)**:
    *   On 401 response, interceptor calls POST `/api/v1/auth/refresh`.
    *   If success, retry original request with new token.
    *   If fail, redirect to `/login`.

3.  **Role-Based Protection**:
    *   Create a `RoleGuard` component or Higher-Order Component (HOC) to wrap pages.
    *   Check `user.role` against required permissions before rendering.

---

## 4. Detailed Page & Feature Breakdown by Role

### A. Dashboard (`/`)
*   **Super Admin**: System health, User stats, Total Revenue/Spend.
*   **Marketing Manager**: Active Campaigns, Budget Usage, Lead Generation Stats.
*   **Admission Manager**: Live Call Status, Lead Pipeline Summary, Agent Performance.
*   **Finance**: Pending Budget Approvals, Recent Transactions.

### B. Leads Module (`/leads`)
*   **View**:
    *   **Kanban Board**: Columns for statuses (New, Contacted, Interested, Enrolled).
    *   **Data Table**: Sortable/Filterable list.
*   **Features**:
    *   **Click-to-Call**: Button next to phone number. Triggers POST `/api/v1/smartflo/click-to-call`.
    *   **Filters**: By Source, Status, Assigned Agent.
*   **Permissions**:
    *   `Admission Manager`: View All.
    *   `Admission Executive`: View Assigned Only.

### C. Campaigns Module (`/campaigns`)
*   **UI**: Grid view of campaigns with status badges (Draft, Active, Completed).
*   **Actions**:
    *   **Create**: Form for Name, Date Range, Budget, Platform. (POST `/api/v1/campaigns`)
    *   **Status Toggle**: Switch to Activate/Pause. (PATCH `/api/v1/campaigns/:id/status`)
    *   **Asset Manager**: Upload creatives. (POST `/api/v1/assets`)
*   **Permissions**: `Marketing Manager` (Full Access), `Designer` (Upload Assets).

### D. Budgets & Approvals (`/budgets`)
*   **UI**: Split view - "My Requests" vs "Pending Approvals".
*   **Workflow**:
    1.  **Marketing** creates request (POST `/api/v1/budgets`).
    2.  **Finance** sees request in "Pending" list.
    3.  **Finance** clicks Approve/Reject (PATCH `/api/v1/budgets/:id/approve`).
    4.  **Marketing** uploads Proof (POST `/api/v1/proofs`).
    5.  **Finance** verifies Proof (PATCH `/api/v1/proofs/:id/verify`).

### E. Accounting (`/accounting`)
*   **Tabs**:
    1.  **Payment Records**: Table of all incoming payments. (GET/POST `/api/v1/accounting/payments`)
    2.  **Ad Spends**: Tracker for daily ad spend per platform. (GET/POST `/api/v1/accounting/ad-spends`)
*   **Permissions**: `Finance` (Payments), `Marketing Manager` (Ad Spends).

### F. Telephony / Smartflo (`/telephony`)
*   **Live Monitor (Manager Only)**:
    *   List of active calls.
    *   **Actions**: Listen (Monitor), Whisper (Coach), Barge (Join), Hangup.
    *   **API**: GET `/api/v1/smartflo/live-calls`, POST `/api/v1/smartflo/call-operation`.
*   **Call History**:
    *   Table of past calls with Recording playback.
    *   **API**: GET `/api/v1/smartflo/call-records`.

---

## 5. API Integration Reference
| **Budgets** | Request Budget | `POST` | `/api/v1/budgets` | Marketing Manager |
| | Approve Budget | `PATCH` | `/api/v1/budgets/:id/approve` | Finance |
| | Upload Proof | `POST` | `/api/v1/proofs` | Auth User |
| | Verify Proof | `PATCH` | `/api/v1/proofs/:id/verify` | Finance |
| **Leads** | Public Submit | `POST` | `/api/v1/leads/submit` | Public |
| | Create Lead | `POST` | `/api/v1/leads` | Auth User |
| | | | | *Returns `lead_reference_id` (e.g., egsp-admission-20251212-123456)* |
| | List Leads | `GET` | `/api/v1/leads` | Auth User (Scoped) |
| | Initiate Call | `POST` | `/api/v1/leads/:id/call` | Admin/Manager/Exec |
| | Add Note | `POST` | `/api/v1/leads/:id/notes` | Auth User |
| | Transfer Lead | `POST` | `/api/v1/leads/:id/transfer` | Admin/Manager |
| | Update Status | `PATCH` | `/api/v1/leads/:id/status` | Auth User |
| **Accounting** | Add Payment | `POST` | `/api/v1/accounting/payments` | Finance |
| | Add Ad Spend | `POST` | `/api/v1/accounting/ad-spends` | Marketing Manager |
| **Smartflo** | Click-to-Call | `POST` | `/api/v1/smartflo/click-to-call` | Admission Exec/Manager |
| | Live Calls | `GET` | `/api/v1/smartflo/live-calls` | Admission Manager |
| | Call Records | `GET` | `/api/v1/smartflo/call-records` | Auth User (Scoped) |
| | Monitor/Barge | `POST` | `/api/v1/smartflo/call-operation` | Admission Manager |
| **Analytics** | Admin Stats | `GET` | `/api/v1/analytics/admin` | Super Admin |
| | Marketing Stats | `GET` | `/api/v1/analytics/marketing` | Marketing Manager |
| | Admission Stats | `GET` | `/api/v1/analytics/admission` | Admission Manager |
| | Finance Stats | `GET` | `/api/v1/analytics/finance` | Finance |
| | Executive Stats | `GET` | `/api/v1/analytics/executive` | Admission Executive |
| **Search** | Global Search | `GET` | `/api/v1/search?q=...` | Auth User (Scoped) |

> **Note on Search**: Implement **Debouncing** (wait 300-500ms after user stops typing) on the frontend search input to prevent excessive API calls.
